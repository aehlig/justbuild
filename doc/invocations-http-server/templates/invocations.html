{% extends "base.html" %}
{% block heading %}
Recent Invocations
{% endblock %}

{% block content %}
{% if filter_info %}
<h1>Invocations filtered by {{ filter_info | e }}</h1>
{% else %}
<h1>Recent Invocations</h1>
<b>Filter by:</b>
  <a href="/filterinvocations/noncached">only not fully cached</a>
  {% if context_filters %}
  <details>
    <summary>Context</summary>
    {% for entry in context_filters %}
      <tt>{{ entry.key | e }}</tt>:
      {% for value in entry["values"] %}
        {% if loop.index > 1 %}
        ,
        {% endif %}
        <a href="/filterinvocations/context/{{ entry["key_hex"] | e }}/{{ value["value_hex"] }}"><tt>{{ value["value"] | e }}</tt></a>
      {% endfor %}<br>
    {% endfor %}
  </details>
  {% endif %}
  {% if remote_props_filters %}
  <details>
    <summary>Remote properties</summary>
    {% for entry in remote_props_filters %}
      <tt>{{ entry.key | e }}</tt>:
      {% for value in entry["values"] %}
        {% if loop.index > 1 %}
        ,
        {% endif %}
        <a href="/filterinvocations/remote/prop/{{ entry["key_hex"] | e }}/{{ value["value_hex"] }}"><tt>{{ value["value"] | e }}</tt></a>
      {% endfor %}<br>
    {% endfor %}
  </details>
  {% endif %}
{% endif %}
{% if invocations %}
<ul>
  {% for invocation in invocations %}
  <li> <a href="/invocations/{{invocation.name |e}}"><tt>{{ invocation.name | e }}</tt></a>
    {% if invocation.subcommand %}
    <tt>{{ invocation.subcommand | e }}</tt>
    {% endif %}
    {% if invocation.target %}
    <tt>{{ invocation.target | e}}</tt>
    {% endif %}
    {% if invocation.exit_code != 0 %}
    <b>
      {% if invocation.exit_code == 1 %}
      build failed
      {% elif invocation.exit_code == 2 %}
      failed
      {% elif invocation.exit_code == 8 %}
      analysis failure
      {% elif invocation.exit_code == 16 %}
      build-environment failure
      {% elif invocation.exit_code == 32 %}
      syntax/invocation error
      {% else %}
      exit code {{ invocation.exit_code | e }}
      {% endif %}
    </b>
    {% endif %}
    <ul>
      {% if invocation.remote_address %}
      <li>
        Remote: <tt>{{ invocation.remote_address | e }}@{{ invocation.remote_props | e }}</tt>
      </li>
      {% endif %}
      {% if invocation.config %}
      <li>
        Configuration: <tt>{{ invocation.config | e}}</tt>
      </li>
      {% endif %}
      {% if invocation.context %}
      <li>
        Context: <tt>{{ invocation.context | e }}</tt>
      </li>
      {% endif %}
    </ul>
  </li>
  {% endfor %}
</ul>
{% else %}
<i>(none)</i>
{% endif %}
{% endblock %}
